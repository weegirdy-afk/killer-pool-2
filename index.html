<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Killer Pool</title>

<style>
  body {
    font-family: Arial, sans-serif;
    background: #111;
    color: #fff;
    text-align: center;
    padding: 16px;
    margin: 0;
  }

  input, button {
    width: 90%;
    max-width: 280px;
    padding: 12px;
    margin: 6px 0;
    font-size: 18px;
    border-radius: 8px;
    border: none;
  }

  button { font-weight: bold; cursor: pointer; }

  .secondary { background: #3498db; }
  .play { background: #2ecc71; }
  .miss { background: #e67e22; }
  .pot { background: #1abc9c; }
  .black { background: #e74c3c; color: #fff; }

  .player {
    margin: 10px 0;
    font-size: 22px;
    opacity: 0;
    transform: translateY(20px);
    animation: deal 0.5s ease forwards;
  }

  @keyframes deal { to { opacity: 1; transform: translateY(0); } }

  .cardBig { display: inline-block; font-size: 56px; margin: 10px 0 2px; }
  .nameBig { font-size: 28px; margin: 6px 0 10px; }

  #log {
    margin-top: 14px;
    font-size: 16px;
    opacity: 0.9;
    min-height: 22px;
  }

  .section { max-width: 520px; margin: 0 auto; }

  /* Ref button + overlay */
  #refBtn {
    position: fixed;
    top: 12px;
    right: 12px;
    width: auto;
    max-width: none;
    padding: 10px 12px;
    border-radius: 999px;
    font-size: 16px;
    background: #444;
    color: #fff;
    z-index: 1000;
    display: none; /* only show during game */
  }

  #refOverlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.95);
    color: #fff;
    padding: 18px;
    overflow: auto;
    z-index: 2000;
    text-align: center;
  }

  #refPanel {
    max-width: 520px;
    margin: 0 auto;
  }

  #refList {
    text-align: left;
    margin: 14px auto;
    max-width: 420px;
    font-size: 18px;
    line-height: 1.7;
  }

  .pill {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 999px;
    background: #222;
    margin-left: 8px;
    font-size: 14px;
    opacity: 0.95;
  }

  .muted { opacity: 0.75; }
</style>
</head>

<body>
  <button id="refBtn" onclick="toggleRef()">üßë‚Äç‚öñÔ∏è Ref</button>

  <div class="section">
    <h1>üé± Killer Pool</h1>

    <!-- SETUP -->
    <div id="setup">
      <div id="playerList"></div>

      <button class="secondary" onclick="addPlayer()">‚ûï Add Player</button>
      <button onclick="drawCards()">üé¥ Draw Cards</button>

      <div id="results"></div>

      <button id="startBtn" class="play" onclick="startGame()" style="display:none;">
        ‚ñ∂Ô∏è Play Game
      </button>
    </div>

    <!-- GAME -->
    <div id="game" style="display:none;">
      <div id="currentCard" class="cardBig"></div>
      <div id="currentName" class="nameBig"></div>

      <button class="miss" onclick="doAction('miss')">‚ùå Miss</button>
      <button class="pot" onclick="doAction('pot')">üéØ Pot</button>
      <button class="black" onclick="doAction('black')">‚ö´ Black Ball</button>

      <div id="log"></div>
    </div>
  </div>

  <!-- REF OVERLAY (Option 2) -->
  <div id="refOverlay" onclick="toggleRef()">
    <div id="refPanel" onclick="event.stopPropagation()">
      <h2>üßë‚Äç‚öñÔ∏è Ref Mode</h2>
      <div class="muted">Tap outside (or the Ref button) to close.</div>
      <div id="refList"></div>
      <button onclick="toggleRef()">Close</button>
    </div>
  </div>

<script>
  const baseDeck = ["A","K","Q","J","10","9","8","7","6","5","4","3","2"];
  let deck = [];

  let players = [];        // { name, card, lives }
  let activePlayers = [];  // indices into players[]
  let currentIdx = null;   // index into players[] of current shooter

  function shuffleDeck() {
    deck = [...baseDeck];
    for (let i = deck.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [deck[i], deck[j]] = [deck[j], deck[i]];
    }
  }

  function addPlayer() {
    const count = document.querySelectorAll("#playerList input").length;
    if (count >= 13) {
      alert("Maximum 13 players (A‚Äì2).");
      return;
    }
    const input = document.createElement("input");
    input.placeholder = "Player name";
    document.getElementById("playerList").appendChild(input);
  }

  function drawCards() {
    players = [];
    activePlayers = [];
    currentIdx = null;

    shuffleDeck();

    const results = document.getElementById("results");
    results.innerHTML = "<h2>Dealing Cards‚Ä¶</h2>";

    const inputs = [...document.querySelectorAll("#playerList input")];
    const names = inputs.map(i => i.value.trim()).filter(Boolean);

    if (names.length === 0) {
      results.innerHTML = "<h2>Please enter at least 1 name.</h2>";
      document.getElementById("startBtn").style.display = "none";
      return;
    }

    if (names.length > 13) {
      results.innerHTML = "<h2>Max 13 players.</h2>";
      document.getElementById("startBtn").style.display = "none";
      return;
    }

    let delay = 0;

    names.forEach((name) => {
      if (deck.length === 0) shuffleDeck();
      const card = deck.pop();

      // Everyone starts with 3 lives (hidden from players)
      players.push({ name, card, lives: 3 });

      setTimeout(() => {
        const div = document.createElement("div");
        div.className = "player";
        div.textContent = `${name} ‚Äî ${card}`;
        results.appendChild(div);
      }, delay);

      delay += 350;
    });

    setTimeout(() => {
      document.getElementById("startBtn").style.display = "inline-block";
    }, delay + 150);
  }

  function startGame() {
    if (players.length === 0) return;

    activePlayers = players.map((_, i) => i);

    document.getElementById("setup").style.display = "none";
    document.getElementById("game").style.display = "block";

    // show Ref button only in game
    document.getElementById("refBtn").style.display = "inline-block";

    nextShooter("Game started. Random shooter selected.");
  }

  function nextShooter(message) {
    if (activePlayers.length === 0) {
      document.getElementById("currentCard").textContent = "";
      document.getElementById("currentName").textContent = "Game Over";
      setLog("No players left.");
      refreshRefList();
      return;
    }

    const pick = Math.floor(Math.random() * activePlayers.length);
    currentIdx = activePlayers[pick];

    document.getElementById("currentCard").textContent = players[currentIdx].card;
    document.getElementById("currentName").textContent = players[currentIdx].name;

    setLog(message || "Next shooter.");
    refreshRefList();
  }

  function setLog(text) {
    document.getElementById("log").textContent = text;
  }

  function doAction(type) {
    if (currentIdx === null) return;

    const p = players[currentIdx];

    if (type === "miss") {
      p.lives -= 1;

      if (p.lives <= 0) {
        activePlayers = activePlayers.filter(i => i !== currentIdx);
        nextShooter(`${p.name} MISSED and is OUT.`);
        return;
      }

      nextShooter(`${p.name} MISSED and loses a life.`);
      return;
    }

    if (type === "pot") {
      nextShooter(`${p.name} POTTED. (No life lost)`);
      return;
    }

    if (type === "black") {
      p.lives += 1;
      nextShooter(`${p.name} potted the BLACK BALL and gains a life.`);
      return;
    }
  }

  // ---- REF MODE (Option 2) ----
  function toggleRef() {
    const overlay = document.getElementById("refOverlay");
    const nowOpen = overlay.style.display !== "block";
    if (nowOpen) {
      refreshRefList();
      overlay.style.display = "block";
    } else {
      overlay.style.display = "none";
    }
  }

  function refreshRefList() {
    const refList = document.getElementById("refList");
    if (!refList) return;

    const activeSet = new Set(activePlayers);

    // Show in original order, but mark OUT players
    const lines = players.map((p, i) => {
      const status = activeSet.has(i) ? "IN" : "OUT";
      const statusPill = `<span class="pill">${status}</span>`;
      const currentPill = (i === currentIdx && activeSet.has(i)) ? `<span class="pill">SHOOTER</span>` : "";
      return `${p.name} ‚Äî ${p.card} ‚Äî ${p.lives} lives ${statusPill} ${currentPill}`;
    });

    refList.innerHTML = lines.join("<br>");
  }

  // Start with two inputs
  addPlayer();
  addPlayer();
</script>
</body>
</html>
